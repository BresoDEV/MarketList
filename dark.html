<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Compras</title>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        border: 0;
        font-family: 'Open Sans';
        color: #eee;
        cursor: pointer;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
    }

    html,
    body {
        background-color: #333;
    }

    .topo {
        margin-left: 10%;
        width: 73%;
        background-color: #333;
        padding: 3%;
        margin-top: 20px;
        border-radius: 15px;
        box-shadow: 5px 5px 22px #666;
    }

    table {
        width: 100%;
        text-align: center;
    }



    input,
    select,
    option {
        width: 80%;
        padding: 5px;
        border-radius: 5px;
        margin-top: 3px;
        background-color: #333;
        border: 1px solid #666;
    }

    th {
        color: rgb(183, 180, 180);
    }

    .vm {
        background-color: red;
    }

    .w50 {
        width: 100%;
        padding: 2px;
    }

    button {
        width: 100%;
        padding: 5px;
        border-radius: 5px;
        background-color: rgb(54, 144, 96);
        color: aliceblue;
    }
    .button2 { 
        padding: 5px;
        border-radius: 5px;
        background-color: rgb(54, 144, 96);
        color: aliceblue;
        width: 40%;
    }

    hr {
        background-color: rgb(255, 255, 255);
        margin-bottom: 2px;
        margin-top: 2px;
        padding-bottom: 1px;

    }
    textarea{
        width: 90%;
        resize: none;
        background-color: #666;
        border-radius: 10px;
        padding: 5px;
        color: aliceblue;
    }
</style>

<body>


    <div class="topo">
        <table>
            <tr>
                <td><label for="item">Produto</label></td>
                <td><input type="text" name="item" id="Produto" placeholder="Ex: Coca-Cola 2ltrs"></td>
            </tr>
            <tr>
                <td><label for="Quantidade">Quantidade</label></td>
                <td><input type="number" name="Quantidade" min="1" id="Quantidade" value="1"></td>
            </tr>
            <tr>
                <td><label for="Categoria">Categoria</label></td>
                <td>
                    <select name="Categoria" id="Categoria">
                        <option value="Limpeza">Limpeza</option>
                        <option value="Comida">Comida</option>
                        <option value="Bebida">Bebida</option>
                        <option value="Higiene">Higiene</option>
                        <option value="Remedios">Remedios</option>
                        <option value="Frutas">Frutas</option>
                        <option value="Bebê">Bebê</option>
                        <option value="Besteiras">Besteiras</option>
                    </select>
                </td>
            </tr>
<!--

                &#129529;
&#127858;
&#129371;
&#129524;
&#128138;
&#127813;
&#127868;
&#127829;
            -->
            <tr>
                <td colspan="4">
                     
                </td>
            </tr>
            <tr>
                <td colspan="2"><button id="Adicionar">Adicionar</button></td>
            </tr>
            <tr><td colspan="2"></td></tr>
            <tr><td colspan="2"><hr></td></tr>
            <tr><td colspan="2"></td></tr>
            <tr>
                <td colspan="2"><button id="Resetar">Resetar Toda Lista</button></td>
            </tr>
            <tr>
                <td colspan="2"></td>
            </tr>
            <tr>
                <td colspan="2"></td>
            </tr>
        </table>
    </div>

    <!------------------------------>
    <div class="topo" id="table">

    </div>
    <!------------------------------>

    <div class="topo">
        
        <center>
            <h3>Compartilhar/Carregar Listas</h3><br>
            <textarea name="" id="textarea" cols="10" rows="3" placeholder="Código..."></textarea>
        </center>
        <br> 
        <center>
            <button class="button2" id="CarregarCodigo">Carregar</button>
        <button class="button2" id="Compartilhar">Compartilhar</button>
        </center>
        
    </div>
    <div class="topo">
        <center>
            <h3>Salvar/Carregar Listas</h3><br>
            <input type="text" name="" id="NomeSalvar" placeholder="Ex: Compra Economica"><br><br>
            <button id="Salvar">Salvar</button>
        </center>
        <br>
        <hr>
        <table id="ul">

        </table>
    </div>

</body>
<script>

    //exibir listas salvas
    var ul = document.getElementById('ul')
    for (let i = 0; i < 1000; i++) {
        if (localStorage.getItem('ListaComprasPronta_' + i)) {
            //NomeSalvar
            ul.innerHTML += `

            <tr>
                <td colspan='2'>
                    ${localStorage.getItem('NomeSalvar' + i)}
                </td> 
                <td>
                    <button onclick="carregarLista(${i})" class='w50'>Carregar Lista</button>
                </td>
                <td>
                    <button onclick="apagarLista(${i})" class='vm w50'>Apagar Lista</button>
                </td>
            </tr>

            <tr>
                <td colspan='4'>
                   <hr>
                </td>
            </tr>



            `
        }
    }

    function carregarLista(n) {
        let table = document.getElementById('table')
        var lista = localStorage.getItem('ListaComprasPronta_' + n)

         lista = lista.replace(/<hr>/g,'<!--hr removido-->');
       
        table.innerHTML = lista

       
        
        for (let i = 0; i < 1000; i++) {

            if (document.getElementById('ID_' + i)) {
                console.log('ID_' + i)
                document.getElementById('ID_' + i).addEventListener('click', () => {
                    
                    //deixa verde
                   // document.getElementById('ID_' + i).style.backgroundColor='green'
                   // document.getElementById('ID_' + i).innerHTML='V'
                   

                   var linha = document.getElementById('ID_' + i).parentNode.parentNode
                   linha.parentNode.removeChild(linha)
                })
            }

        }


    }

    function apagarLista(n) {
        localStorage.removeItem('ListaComprasPronta_' + n)
        localStorage.removeItem('NomeSalvar' + n)
        window.location.reload()
    }


    document.getElementById('Salvar').addEventListener('click', () => {

        let NomeSalvar = document.getElementById('NomeSalvar').value
        let ind = 0;
        for (let i = 0; i < 1000; i++) {
            if (!localStorage.getItem('ListaComprasPronta_' + i)) {
                ind = i;
                break;
            }
        }
        localStorage.setItem('ListaComprasPronta_' + ind, s)
        localStorage.setItem('NomeSalvar' + ind, NomeSalvar)
        window.location.reload()
    })

    //==========================================

    function cripto(m) {
        return m.replace(/[A-Za-z]/g, (c) => {
            return String.fromCharCode(c.charCodeAt(0) +
                (c.toLowerCase() < 'n' ? 13 : -13))
        })
    }

    document.getElementById('CarregarCodigo').addEventListener('click', () => {
        //console.log(cripto(document.getElementById('table').innerHTML))
        document.getElementById('table').innerHTML=cripto(document.getElementById('textarea').value)
        document.getElementById('textarea').value=''
    })

    document.getElementById('Compartilhar').addEventListener('click', () => {
        //console.log(cripto(document.getElementById('table').innerHTML))
        var um = document.getElementById('table').innerHTML.replace(/\n/g,'')
        var dois = um.replace(/  /g,'')
        document.getElementById('textarea').value=cripto(dois)
        document.getElementById('textarea').select()
        setTimeout(() => {
            document.execCommand('copy')
            document.getElementById('textarea').value='Codigo copiado com sucesso!'
            setTimeout(() => {
                document.getElementById('textarea').value=''
            }, 3000);
        }, 1000);
    })

    document.getElementById('Resetar').addEventListener('click', () => {
        for (let i = 0; i < 1000; i++) {
            if (localStorage.getItem('ListaCompras_' + i)) {
                localStorage.removeItem('ListaCompras_' + i)
            }
        }
        window.location.reload()
    })

    document.getElementById('Adicionar').addEventListener('click', () => {
        var a = document.getElementById('Produto').value
        var b = document.getElementById('Quantidade').value
        var c = document.getElementById('Categoria').value
        addItem(c, a, b)
    })

    function addItem(cat, nome, quant) {
        var index = 0;
        for (let i = 0; i < 1000; i++) {
            if (!localStorage.getItem('ListaCompras_' + i)) {
                index = i;
                break;
            }
        }
        localStorage.setItem('ListaCompras_' + index, cat + '|' + nome + '|' + quant + '|0')

        window.location.reload()
    }

    const table = document.getElementById('table')
    var events = []
    var s = `<table>
                <tr>
                    <th>Categoria</th>
                    <th>Item</th>
                    <th>Quantidade</th>
                    <th></th>
                </tr>
                <tr>
                    <td colspan='4'><hr></td>
                </tr>
                `

    for (let i = 0; i < 1000; i++) {
        if (!localStorage.getItem('ListaCompras_' + i)) {
            break;
        }
        else {
            var a = localStorage.getItem('ListaCompras_' + i).split('|')

            if (a[3] !== 'x') {
                events.push(i)
                s += `
                    <tr>
                            <td>${a[0]}</td>
                            <td>${a[1]}</td>
                            <td>${a[2]}</td>
                            <td><button id="ID_${i}" class="vm">X</button></td>
                        </tr>

                        <tr>
                            <td colspan='4'><hr></td>
                        </tr>
                    `

            }

        }
    }

    s += '</table>'
    table.innerHTML = s;

    events.forEach(element => {

        document.getElementById('ID_' + element).addEventListener('click', () => {
            localStorage.setItem('ListaCompras_' + element, 'a|a|a|x')
            window.location.reload()
        })

    });


</script>

</html>